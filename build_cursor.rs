use std::fs::File;
use std::io::{Write, Result};

fn main() -> Result<()> {
    let width = 32u32;
    let height = 32u32;
    
    // Hotspot at the tip of the broom bristles (Bottom-Left)
    // Adjusted to (1, 27) based on the pixel data analysis of your image.
    let hotspot_x = 1u16;
    let hotspot_y = 27u16;

    // 32x32 ARGB Pixel Data extracted from 'input_file_1.png'
    // Format: 0xAARRGGBB
    let pixels: [u32; 1024] = [
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x0F8E8E8E, 0xB46C6866, 0xFF523222, 0xFF4D3224, 0xAD706C6A, 0x0B8E8E8E,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x40787776, 0xFF533527, 0xFF955F42, 0xFF6D3D24, 0xFF423028, 0x1E858585,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x36898989, 0xE355443C, 0xFF88543A, 0xFF713E27, 0xFF4C2615, 0xFF443631, 0x1E878787,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x018F8E8F, 0xF5625956, 0xFF6F422D, 0xFF804B30, 0xFF4E2717, 0xF63A2620, 0x59787878, 0x028F8F8F,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x6D797977, 0xFF4C3326, 0xFF864F34, 0xFF5B2F1B, 0xFF382219, 0x725E5C5C, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x1C898988,
        0xCB53453E, 0xFF8A5236, 0xFF6E3B23, 0xFF412418, 0x85636160, 0x238F8F8E, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x646A6462,
        0xFF6A3F2A, 0xFF774127, 0xFF462518, 0xD8504B4A, 0x0A8D8D8D, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x088B8A8A, 0xD1634538,
        0xFF834C31, 0xFF552B18, 0xE44A3E39, 0x29868585, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x038E8E8E, 0xAF524843, 0xFF7A472E,
        0xFF653620, 0xFF33231D, 0x94767675, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x90767574, 0xFF633A28, 0xFF774128,
        0xFF432214, 0x89565453, 0x098E8E8E, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x27848484, 0xDF463730, 0xFF894F32, 0xFF522917,
        0xFC32241D, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x81635C59, 0xFF75442D, 0xFF60321D, 0xFF371F15,
        0x68676664, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x1F888887,
        0x2A848483, 0x1E8D8C8C, 0x00000000, 0x5D7E7E7E, 0xF85A3B2D, 0xFF7E462C, 0xFF462214, 0xD2493E39,
        0x158A8A8A, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xBB6F6B67,
        0xFF514635, 0xDF6A5D50, 0x94686867, 0xC561544F, 0xFF7B482F, 0xFF5E311D, 0xFF2A150D, 0x70706D6C,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xBB7C746A,
        0xFF91602E, 0xFF9E6E38, 0xFF48341E, 0xFF3B2117, 0xFF5C301D, 0xFF412013, 0xD754514E, 0x1F8D8D8C,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xBB736859,
        0xFFB68445, 0xFFBF8945, 0xFFB38244, 0xFF654424, 0xFF4A2D19, 0xFB2A1912, 0x3B848483, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x30828181, 0xDE8E7248,
        0xFFDEAC61, 0xFFD5A157, 0xFFBF8C4A, 0xFFBC8747, 0xFFAB773A, 0xFF7A5730, 0xC964564A, 0x19838382,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xE83C302B, 0xFF674226,
        0xFFA0713B, 0xFFC79756, 0xFFBE8947, 0xFFBB813E, 0xFF9F672C, 0xFF92612A, 0xFF472D15, 0xBC5A5754,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x1E8C8C8C, 0xB6757271, 0xFB3E261C, 0xFF3A2015,
        0xFF422314, 0xFF644225, 0xFFA07038, 0xFF9B672F, 0xFF8F5B25, 0xFE7A4E22, 0xE95E5345, 0x58797773,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x74696969, 0xFF362015, 0xFF3F2517, 0xFF26150E,
        0xFF4E2C1C, 0xFF472718, 0xFF432617, 0xFF684120, 0xFF5A3A1C, 0xB058534D, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x0E8E8E8E, 0x3F7F7F7E, 0xDE685A48, 0xF88F6D41, 0xFFA47A45, 0xFF5A3D23, 0xFF492A19,
        0xFF392014, 0xFF341C11, 0xFF331B10, 0xFF27150D, 0xCA38302D, 0x0C8C8C8B, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x038F8F8F, 0xA47A7874, 0xFF7D6745, 0xFFB1874E, 0xFFB4864A, 0xFFC39250, 0xFFBD8D4F, 0xFF9A6D38,
        0xFF492A16, 0xFF371D10, 0xFF26140B, 0xFF1A0D09, 0x596D6B6A, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x088C8C8C,
        0xAF6F6B62, 0xFF957444, 0xFFB2864C, 0xFFC89959, 0xFFBE8E51, 0xFFA87941, 0xFFD7A65F, 0xFFBB8A4B,
        0xFFA57036, 0xFF6E441E, 0xFF4B2C14, 0xFF372C27, 0x21858585, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x3480807F, 0x9F6D6457,
        0xFF9C743F, 0xFFBF8F52, 0xFFC89451, 0xFFC08A4A, 0xFFC29253, 0xFFD4A461, 0xFFCF9D58, 0xFFB07B3E,
        0xFFB07C3E, 0xFF935D28, 0xFF6B3D17, 0xA14A4A4A, 0x068F8F8E, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x018F8F8F, 0x00000000, 0x8D717071, 0x975D5956, 0x9760584D, 0xF7715A3F, 0xFFB88849,
        0xFFD6A25D, 0xFFD49D57, 0xFFCD944E, 0xFFD59F59, 0xFFD6A45F, 0xFFE3B671, 0xFFC99654, 0xFFC68D48,
        0xFFBC8445, 0xFF895422, 0xFF72441B, 0x8B4D4B4A, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0xAF808080, 0x60606060, 0x985B5B5A, 0xFF363027, 0xFF4A371F, 0xFFBB8B4C, 0xFFB17B41,
        0xFFD19B55, 0xFFC9924E, 0xFFD5A058, 0xFFD59F59, 0xFFD5A664, 0xFFDDAE68, 0xFFB98242, 0xFFD09B55,
        0xFF9D642A, 0xFF905A22, 0xF7704A23, 0x57787875, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x0F8E8E8E, 0x72727271, 0xFF443E39, 0xFF42331F, 0xFF7E5A30, 0xFFBE8745, 0xFFC28C48, 0xFFB98142,
        0xFFB67F3F, 0xFFD8A762, 0xFFD5A059, 0xFFCD9753, 0xFFC99654, 0xFFD09C55, 0xFFC4914E, 0xFFBE8644,
        0xFFAC7535, 0xFF865220, 0xE9573A20, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x2D8C8C8C, 0xE23E3A37, 0xFF55371C, 0xFF9D6E39, 0xFFBD8848, 0xFFBC8748, 0xFFA6713A, 0xFFB67F42,
        0xFFD49F58, 0xFFD29C57, 0xFFC28B4A, 0xFFB87F41, 0xFFC28845, 0xFFB47B3C, 0xFFC58E4D, 0xFFAF7737,
        0xFF905824, 0xFF7A481B, 0xE9564A3C, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x966A6663, 0xFF704723, 0xFFA76E35, 0xFFB67D3E, 0xFFA9733A, 0xFFC08D4F, 0xFFC38945,
        0xFFC5904E, 0xFFB67D3E, 0xFF9F652D, 0xFFB67B3D, 0xFFB17A3E, 0xFFCC9854, 0xFFB7803E, 0xFF925C28,
        0xFF824E1E, 0xFF68401E, 0x527A756F, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x0B8A8A8A, 0xA15A524B, 0xFD633E1E, 0xFF976330, 0xFFAD7B43, 0xFFB37F43, 0xFFBB8444,
        0xFFA87137, 0xFFB1783A, 0xFF9F662E, 0xFFAD763C, 0xFFB17B3F, 0xFFA16C34, 0xFF8F5A26, 0xFF7D491C,
        0xFF74431A, 0xC7564737, 0x14898989, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0xA3645F5C, 0xFF4C3320, 0xFF6D3E19, 0xFF8F5928, 0xFF97602A,
        0xFF935E28, 0xFF99632D, 0xFFAD783B, 0xFF9C6730, 0xFF9A642E, 0xFF855122, 0xFF7F4B1F, 0xFF653E1A,
        0xFF4E4132, 0x60868583, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x0B8E8D8D, 0x337B7A7A, 0xDA473F3A, 0xFF5A3A26, 0xFF522D13,
        0xFF77461D, 0xFF834F21, 0xFF8E5825, 0xFF845223, 0xFF6B401B, 0xFF6B411C, 0xFF62462E, 0xB267625D,
        0x1E878786, 0x028F8E8E, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
        0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
    ];

    let mut cursor_data = Vec::new();

    // 1. ICONDIR
    cursor_data.extend_from_slice(&[0, 0]); // Reserved
    cursor_data.extend_from_slice(&[2, 0]); // Type = Cursor
    cursor_data.extend_from_slice(&[1, 0]); // Count = 1

    // 2. ICONDIRENTRY
    cursor_data.push(width as u8);
    cursor_data.push(height as u8);
    cursor_data.push(0); // Palette (0=Truecolor)
    cursor_data.push(0); // Reserved
    cursor_data.extend_from_slice(&hotspot_x.to_le_bytes());
    cursor_data.extend_from_slice(&hotspot_y.to_le_bytes());
    
    // Placeholder for size and offset
    let size_offset_idx = cursor_data.len();
    cursor_data.extend_from_slice(&[0, 0, 0, 0]); 
    cursor_data.extend_from_slice(&[22, 0, 0, 0]); // Offset constant

    let bmp_start = cursor_data.len();

    // 3. BITMAPINFOHEADER
    cursor_data.extend_from_slice(&40u32.to_le_bytes()); // Size
    cursor_data.extend_from_slice(&(width as i32).to_le_bytes());
    cursor_data.extend_from_slice(&((height * 2) as i32).to_le_bytes());
    cursor_data.extend_from_slice(&1u16.to_le_bytes()); // Planes
    cursor_data.extend_from_slice(&32u16.to_le_bytes()); // BitCount
    cursor_data.extend_from_slice(&0u32.to_le_bytes()); // Compression
    cursor_data.extend_from_slice(&0u32.to_le_bytes()); // SizeImage
    cursor_data.extend_from_slice(&0i32.to_le_bytes());
    cursor_data.extend_from_slice(&0i32.to_le_bytes());
    cursor_data.extend_from_slice(&0u32.to_le_bytes());
    cursor_data.extend_from_slice(&0u32.to_le_bytes());

    // 4. Pixel Data (XOR Mask) - Write Bottom-Up
    for y in (0..height).rev() {
        for x in 0..width {
            let idx = (y * width + x) as usize;
            let pixel = pixels[idx];
            
            // BGRA
            let a = (pixel >> 24) as u8;
            let r = (pixel >> 16) as u8;
            let g = (pixel >> 8) as u8;
            let b = pixel as u8;
            
            cursor_data.extend_from_slice(&[b, g, r, a]);
        }
    }

    // 5. AND Mask (1-bit transparency)
    // 0 = Opaque, 1 = Transparent
    let row_padding = ((width + 31) / 32) * 4 - ((width + 7) / 8);
    for y in (0..height).rev() {
        let mut byte = 0u8;
        for x in 0..width {
            let idx = (y * width + x) as usize;
            let alpha = (pixels[idx] >> 24) as u8;
            
            // If alpha is 0, set bit to 1 (Transparent). 
            // Windows uses AND mask for transparency in non-alpha cursors, 
            // but for 32-bit cursors, it uses the Alpha channel if valid.
            // However, we must set AND mask correctly for backward compat 
            // or standard behavior.
            // Convention: If Alpha=0, Mask=1. Else Mask=0.
            if alpha == 0 { 
                byte |= 1 << (7 - (x % 8)); 
            }
            
            if (x + 1) % 8 == 0 {
                cursor_data.push(byte);
                byte = 0;
            }
        }
        if width % 8 != 0 { cursor_data.push(byte); }
        for _ in 0..row_padding { cursor_data.push(0); }
    }

    // Patch file size
    let size = (cursor_data.len() - bmp_start) as u32;
    let sb = size.to_le_bytes();
    cursor_data[size_offset_idx] = sb[0];
    cursor_data[size_offset_idx+1] = sb[1];
    cursor_data[size_offset_idx+2] = sb[2];
    cursor_data[size_offset_idx+3] = sb[3];

    let mut file = File::create("broom.cur")?;
    file.write_all(&cursor_data)?;

    println!("âœ… Created 'broom.cur'");
    Ok(())
}